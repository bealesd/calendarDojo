<html>

<head>
    <meta charset="utf-8" name="viewport" content="width=device-width, initial-scale=1">
    <title>Calendar</title>

    <link rel="stylesheet" type="text/css" href="./css/bootstrap.min.css" />

    <script src="./dateHelper.js" type="text/javascript"></script>
    <script src="./calendarHelper.js" type="text/javascript"></script>
    <script src="./webTimeHelper.js" type="text/javascript"></script>
    <script src="./calendarRepo.js" type="text/javascript"></script>
    <script src="./drawCalendar.js" type="text/javascript"></script>
    <script src="./calendarTimer.js" type="text/javascript"></script>
    <script src="./calendarService.js" type="text/javascript"></script>
    <script src="./eventListener.js" type="text/javascript"></script>
    <script src="./dataStore.js" type="text/javascript"></script>
    <script src="./customEvents.js" type="text/javascript"></script>
    <script src="./calendarController.js" type="text/javascript"></script>
    <script src="./menuEvents.js" type="text/javascript"></script>
    <script src="./callbackService.js" type="text/javascript"></script>
    <link rel="stylesheet" type="text/css" href="./style.css" />
</head>

<body>
    <div class="navbar">
        <a id="calendar">calendar</a>
        <a id="trends">trends</a>
        <div class="subMenu"></div>
    </div>

    <div id="mainContentOne" class="main calendar" style="display:block;">
        <p id="calendarStatus"></p>
        <heading id="date"></heading>
        <br>
        <br>
        <div id="calendarContainer"></div>
    </div>

    <div id="mainContentTwo" class="main trends" style="display:none;">
        <p>Calendar Trends</p>
    </div>

    <div id="dataStore"></div>

    <form id="addOrEditCalendarEvents"
          style="background-color:#FFFFFF; padding:30px; position: absolute; opacity: 50; width: 298px; height: 267.4px; left: 174px; top: 49px; z-index: 950; display: none;">
        <h3 id="formTitle">Title</h3>
        <div hidden id="eventId"></div>
        <input id="eventTitle" type="text" name="title" placeholder="title"><br>
        <input id="eventTime" type="time" name="when" step='900'><br>
        <input id="eventWhere" type="text" name="where" placeholder="where"><br>
        <input id="eventWho" type="text" name="who" placeholder="who"><br>
        <button id='eventAddOrUpdateButton' type="button">Add</button>
        <button id='eventDelete' type="button">Delete</button>
        <button id='eventClose' type="button">Cancel</button>
    </form>

    <script>
        function removeSubMenu() {
            document.getElementsByClassName('subMenu')[0].innerHTML = '';
        };

        this.callbackService = CallbackService();
        this.calendarController = new CalendarController(callbackService.registerSubMenuCallbacks, callbackService.registerTabCallbacks);

        this.calendarController.registerCalendarCallbacks();
        this.eventListener = new EventListener();
        this.menuEvents = new MenuEvents();

        DataStore.addJson({ currentPage: 'calendar' });

        this.onLoad();
        //this.onResize();

        function onLoad() {
            window.addEventListener("load", this.loadTab, false);
        };

        function loadTab() {
            var currentTab = document.querySelectorAll(`.navbar #${DataStore.getJson('currentPage').currentPage}`)[0];
            currentTab.style.backgroundColor = 'darkred';
            var tabKeys = Object.keys(this.callbackService.getTabCallbacks());
            console.log(this.callbackService.subMenuCallbacks);
            for (var i = 0; i < tabKeys.length; i++) {
                if (tabKeys[i] === currentTab.id) {
                    removeSubMenu();
                    this.callbackService.triggerTabCallback(tabKeys[i]);
                    this.callbackService.triggerSubMenuCallback(tabKeys[i]);
                }
            }
            this.menuEvents.setupMenuEvents();
        };

        function onResize() {
            window.addEventListener("resize", resizeThrottler, false);
        };

        function resizeThrottler() {
            var resizeTimeout;
            if (!resizeTimeout) {
                resizeTimeout = setTimeout(function () {
                    resizeTimeout = null;
                    this.loadCalendarPage();
                }, 66);
            }
        };
    </script>

</body>

</html>